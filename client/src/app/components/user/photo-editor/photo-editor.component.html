<main class="photo-editor">

  @if (member && loggedInUser) {
    <section class="photo-editor__top">

      @if (member.photos.length === 0) {
        <div class="photo-editor__empty">
          <mat-icon>info</mat-icon>
          <p>Your album is empty. You may upload some photos.</p>
        </div>
      }

      <div class="photo-editor__gallery">
        @for (photo of member.photos; track $index) {
          <div class="photo-card" [class.photo-card--main]="photo.isMain">
            <div class="photo-card__image">
              <img
                [src]="apiUrl + photo.url_165"
                width="165"
                height="165"
                alt="{{ member.userName }} photo"
              />
              @if (photo.isMain) {
                <span class="photo-card__badge">Profile photo</span>
              }
            </div>

            <div class="photo-card__actions">
              <button
                mat-stroked-button
                color="primary"
                type="button"
                (click)="setMainPhotoComp(photo.url_165)"
                [disabled]="photo.isMain"
              >
                Set profile
              </button>

              <button
                mat-mini-fab
                color="warn"
                type="button"
                (click)="deletePhotoComp(photo.url_165, $index)"
                [disabled]="photo.isMain"
              >
                <mat-icon>delete</mat-icon>
              </button>
            </div>
          </div>
        }

        <!-- Upload card -->
        <div class="upload-card">
          <mat-card
            ng2FileDrop
            (fileOver)="fileOverBase($event)"
            (click)="fileInput.click()"
            [uploader]="uploader"
            [ngClass]="{
              'file-not-over': !hasBaseDropZoneOver,
              'file-over': hasBaseDropZoneOver
            }"
          >
            <mat-card-content class="upload-card__content">
              <div class="upload-card__icon">
                <mat-icon>cloud_upload</mat-icon>
              </div>
              <h3 class="upload-card__title">Add photos</h3>
              <p class="upload-card__subtitle">
                Click to choose or drop images here.
              </p>
              <button type="button" mat-raised-button color="primary">
                Choose photos
              </button>
              <input
                multiple
                type="file"
                #fileInput
                ng2FileSelect
                [uploader]="uploader"
                id="file"
              />
            </mat-card-content>
          </mat-card>
        </div>

      </div>
    </section>
  }

  @if (uploader && uploader.queue && uploader.queue.length) {
    <section class="photo-editor__queue">
      <div class="queue-header">
        <div>
          <h2>Upload queue</h2>
          <p class="queue-sub">
            {{ uploader.queue.length }} file(s) waiting to be uploaded.
          </p>
        </div>
      </div>

      <div class="queue-table">
        <div class="queue-table__head">
          <span>Name</span>
          <span>Size</span>
        </div>

        @for (item of uploader.queue; track $index) {
          <div class="queue-table__row">
            <span class="queue-name">
              {{ item?.file?.name }}
            </span>

            @if (uploader.options.isHTML5) {
              <span class="queue-size">
                {{ item?.file?.size / 1024 / 1024 | number: '.2' }} MB
              </span>
            }
          </div>
        }
      </div>

      <div class="queue-progress">
        <div class="queue-progress__label">
          Queue progress
        </div>
        <div class="queue-progress__bar">
          <div
            class="queue-progress__bar-fill"
            [ngStyle]="{ width: uploader.progress + '%' }"
          ></div>
        </div>
      </div>

      <div class="queue-actions">
        <button
          mat-raised-button
          color="primary"
          type="button"
          (click)="uploader.uploadAll()"
          [disabled]="!uploader.getNotUploadedItems().length"
        >
          <mat-icon>upload</mat-icon>
          Upload all
        </button>

        <button
          mat-raised-button
          color="accent"
          type="button"
          (click)="uploader.cancelAll()"
          [disabled]="!uploader.isUploading"
        >
          <mat-icon>cancel</mat-icon>
          Cancel all
        </button>

        <button
          mat-raised-button
          color="warn"
          type="button"
          (click)="uploader.clearQueue()"
          [disabled]="!uploader.queue.length"
        >
          <mat-icon>delete</mat-icon>
          Remove all
        </button>
      </div>
    </section>
  }

</main>

<!-- <main>
    @if (member && loggedInUser) {
    <section class="top">
        <div>
            @if (member.photos.length === 0) {
            <mat-error>Your album is empty. You may upload some photos.</mat-error>
            }
        </div>
        <div class="gallery">
            @for (photo of member.photos; track $index) {
            <div class="photos">
                <img src="{{apiUrl + photo.url_165}}" width="165" height="165" alt="{{member.userName}} photo">
                <div class="buttons">
                    <button (click)="setMainPhotoComp(photo.url_165)" mat-stroked-button color="primary"
                        [disabled]="photo.isMain">Set profile
                    </button>
                    <button (click)="deletePhotoComp(photo.url_165, $index)" mat-mini-fab color="warn"
                        [disabled]="photo.isMain">
                        <mat-icon>delete</mat-icon>
                    </button>
                </div>
            </div>
            }

            <div class="upload-photo-area">
                <mat-card ng2FileDrop (fileOver)="fileOverBase($event)" (click)="fileInput.click()"
                    [uploader]="uploader" [ngClass]="{
                        'file-not-over': !hasBaseDropZoneOver,
                        'file-over': hasBaseDropZoneOver
                    }">
                    <mat-card-header>
                        <mat-card-title>Add Photos</mat-card-title>
                        <mat-card-subtitle>Click or Drop photos here</mat-card-subtitle>
                    </mat-card-header>
                    <mat-card-content>
                        <mat-icon>cloud_upload</mat-icon>
                    </mat-card-content>
                    <mat-card-actions>
                        <button type="button" mat-raised-button>Choose Photos</button>
                        <input multiple type="file" #fileInput ng2FileSelect [uploader]="uploader" id="file">
                    </mat-card-actions>
                </mat-card>
            </div>
        </div>
    </section>
    }

    @if (uploader && uploader.queue && uploader.queue.length) {
    <section class="queue">
        <h2>Upload Queue</h2>
        <p>Queue length: {{ uploader.queue.length }}</p>

        <div class="photos-queue">
            <div>
                <strong>Name</strong>
                <strong>Size</strong>
            </div>
            @for (item of uploader.queue; track $index) {
            <div>
                <p>{{ item?.file?.name }}</p>
                @if (uploader.options.isHTML5) {
                <p> {{ item?.file?.size / 1024 / 1024 | number:'.2' }} MB</p>
                }
            </div>
            }
        </div>

        <div class="process">
            <div>
                Queue progress:
                <div class="progress-bar" role="progressbar" [ngStyle]="{ 'width': uploader.progress + '%' }">
                </div>
            </div>
            <div class="buttons">
                <button mat-raised-button color="primary" type="button" (click)="uploader.uploadAll()"
                    [disabled]="!uploader.getNotUploadedItems().length">
                    <mat-icon>upload</mat-icon>
                    Upload all
                </button>
                <button mat-raised-button color="accent" type="button" (click)="uploader.cancelAll()"
                    [disabled]="!uploader.isUploading">
                    <mat-icon>cancel</mat-icon>
                    Cancel all
                </button>
                <button mat-raised-button color="warn" type="button" (click)="uploader.clearQueue()"
                    [disabled]="!uploader.queue.length">
                    <mat-icon>delete</mat-icon>
                    Remove all
                </button>
            </div>
        </div>
    </section>
    }
</main> -->